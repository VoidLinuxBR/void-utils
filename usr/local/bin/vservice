#!/bin/sh

SV_DIR="/etc/sv"
ACTIVE_DIR="/var/service"

usage() {
	echo "uso: vservice {enable|disable|start|stop|restart|status} SERVICO"
	exit 1
}

[ $# -ne 2 ] && usage

ACTION="$1"
SERVICE="$2"

SV_PATH="$SV_DIR/$SERVICE"
ACTIVE_PATH="$ACTIVE_DIR/$SERVICE"

case "$ACTION" in
enable)
	[ ! -d "$SV_PATH" ] && {
		echo "erro: serviço '$SERVICE' não existe em $SV_DIR"
		exit 1
	}
	if [ -L "$ACTIVE_PATH" ]; then
		echo "serviço '$SERVICE' já está habilitado"
	else
		ln -s "$SV_PATH" "$ACTIVE_PATH"
		echo "serviço '$SERVICE' habilitado"
	fi
	;;

disable)
	if [ -L "$ACTIVE_PATH" ]; then
		rm "$ACTIVE_PATH"
		echo "serviço '$SERVICE' desabilitado"
	else
		echo "serviço '$SERVICE' não está habilitado"
	fi
	;;

start | stop | restart | status)
	if [ ! -d "$SV_PATH" ]; then
		echo "erro: serviço '$SERVICE' não existe"
		exit 1
	fi
	exec sv "$ACTION" "$SERVICE"
	;;

*)
	usage
	;;
esac
